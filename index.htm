<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">	
	<title></title>
	<meta name="description" content="">
	<meta name="author" content="">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	
	<!-- Fonts
  ================================================== -->
  
	<script type="text/javascript" src="//use.typekit.net/gua1sca.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<!-- CSS
  ================================================== -->

	<link rel="stylesheet" href="app/stylesheets/base.css">
	<link rel="stylesheet" href="app/stylesheets/skeleton.css">	
	
	<link rel="stylesheet" href="http://js.arcgis.com/3.13/esri/css/esri.css">
	<link rel="stylesheet" href="http://js.arcgis.com/3.13/dijit/themes/tundra/tundra.css">
	
	<link rel="stylesheet" href="app/stylesheets/main.css">
	<link rel="stylesheet" href="app/stylesheets/layout.css">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Add This Sharing Widget -->
    <script async type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-53ab205a21ddceee&async=1"></script>
    <script type="text/javascript">
      var addthis_share = {
        url_transforms: {
            shorten: {
                twitter: 'bitly',
                facebook: 'bitly'
            }
        },
        shorteners: {
            bitly: {}
        }
      }; //end addThis_share
    </script>
  <!-- Add This Sharing Widget -->

	<script src="https://cdn.rawgit.com/eligrey/FileSaver.js/master/FileSaver.min.js"></script>

	<!-- Favicons
	================================================== -->
	<!-- <link rel="shortcut icon" href="../images/favicon.ico">
	<link rel="apple-touch-icon" href="../images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="../72x72" href="../images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="../images/apple-touch-icon-114x114.png"> -->
	<script> 
    var dojoConfig = { 
    	parseOnLoad: false, 
    	isDebug: false, 
    	async: true,
    	locale:"en-us",
    	packages: [   
        {name: "common", location: location.pathname.replace(/\/[^/]+$/, "") + "/app/js/common"},
        {name: "root", location: document.location.pathname.replace(/\/[^/]+$/, "") + "/app/js"},
        {name: "suitability", location: location.pathname.replace(/\/[^/]+$/, "") + "/app/js/suitability"},
        {name: "atlas", location: location.pathname.replace(/\/[^/]+$/, "") + "/app/js/forestatlas"},
        {name: "res", location: location.pathname.replace(/\/[^/]+$/, "") + "/resources"}
    	],
    	aliases: [
    		//Util
    		["uifactory", "common/util/UIFactory"],
    		["hashcontroller", "common/util/HashController"],
    		["keyscontroller", "common/util/KeysController"],

    		//Map
		    ["mapconfig", "common/map/MapConfig"],
		    ["mapui", "common/map/MapUI"],		    
		    ["mapevents", "common/map/MapEvents"],	
		    ["mapcontroller", "common/map/MapController"],
		    ["mapmodel", "common/map/MapModel"],	

		    //Main
		    ["mainconfig", "common/main/MainConfig"],
		    ["mainui", "common/main/MainUI"],		    
		    ["mainevents", "common/main/MainEvents"],	
		    ["maincontroller", "common/main/MainController"],
		    ["mainmodel", "common/main/MainModel"],		    
		    
		    //Other Libraries
		    ["ko", "common/lib/knockout221"],
		   // ["resources","resources"],

		    //esri aliases
		    ["legend","esri/dijit/Legend"],
		    ["basemap","esri/dijit/BasemapGallery"],
		    ["basemaplayer","esri/dijit/BasemapLayer"],
		    ["scalebar", "esri/dijit/Scalebar"],
		    ["arcgisutil","esri/arcgis/utils"],
		    ["identityManager","esri/IdentityManager"],
		    ["geometryservice","esri/tasks/GeometryService"],
		    ["editorwidget","esri/dijit/editing/Editor"],
		    ["dynamicLayerInfo","esri/layers/DynamicLayerInfo"],
		    ["infotemplate","esri/InfoTemplate"],
		    ["graphic","esri/graphic"],
		    ["dynamicMapLayer","esri/layers/ArcGISDynamicMapServiceLayer"],
		    ["featureLayer","esri/layers/FeatureLayer"],
		    ["layerDrawingOptions","esri/layers/LayerDrawingOptions"],
		    ["identify","esri/tasks/identify"],
		    ["identifyTask","esri/tasks/IdentifyTask"],
		    ["esriquery","esri/tasks/query"],
		    ["printtemplate","esri/tasks/PrintTemplate"],
		    ["querytask","esri/tasks/QueryTask"],
		    ["find","esri/tasks/FindTask"],
		    ["findparameters","esri/tasks/FindParameters"],
		    ["edit","esri/toolbars/edit"],
		    ["draw","esri/toolbars/draw"],
		    ["simplerenderer","esri/renderers/SimpleRenderer"],
		    ["simplefillsymbol","esri/symbols/SimpleFillSymbol"],
		    ["simplelinesymbol","esri/symbols/SimpleLineSymbol"],
		    ["simplemarkersymbol","esri/symbols/SimpleMarkerSymbol"],
		    ["graphic","esri/graphic"],
		    ["graphicslayer","esri/layers/GraphicsLayer"],
		    ["undomanager","esri/undoManager"],
		    ["delete","esri/dijit/editing/Delete"],
		    ["update","esri/dijit/editing/Update"],
		    ["add","esri/dijit/editing/Add"],
		    ["extent","esri/geometry/Extent"],
		    ["spatialreference","esri/SpatialReference"],
		    ["attachmenteditor","esri/dijit/editing/AttachmentEditor"],
		    ["screenutils","esri/geometry/screenUtils"],
		    ["screenpoint","esri/geometry/ScreenPoint"],
		    ["snappingmanager","esri/SnappingManager"],
		    ["esrirequest","esri/request"],
		    ["layers","esri/layers/Layer"],
		    ["print","esri/dijit/Print"],
		    ["legendlayer","esri/tasks/LegendLayer"],
		    ["esrirequest","esri/request"],
		    ["tiledmap","esri/layers/ArcGISTiledMapServiceLayer"],
		    
		    //Dojo Aliases
		    ["cookie","dojo/cookie"],
		    ["win","dojo/_base/window"],
		    ["keys","dojo/keys"],
		    ["ready","dojo/ready"],
				["xparser", "dojo/parser"],
				["xmlparser", "dojox/xml/parser"],			
				["mparser", "dojox/mobile/parser"],
				["declare", "dojo/_base/declare"],
				["effects", "dojo/_base/fx"],
				["color", "dojo/_base/Color"],
		    ["array", "dojo/_base/array"],
		    ["dom", "dojo/dom"],
		    ["registry", "dijit/registry"],
		    ["construct", "dojo/dom-construct"],
		    ["class", "dojo/dom-class"],
		    ["style", "dojo/dom-style"],
		    ["attr", "dojo/dom-attr"],
		    ["combobox","dijit/form/ComboBox"],
		    ["checkbox", "dijit/form/CheckBox"],
		    ["button","dijit/form/Button"],
				["textbox", "dijit/form/TextBox"],	
				["numbertextbox", "dijit/form/NumberTextBox"],	
				["datetextbox", "dijit/form/DateTextBox"],	
				["togglebutton", "dijit/form/ToggleButton"],
				["radio", "dijit/form/RadioButton"],
				["combobox", "dijit/form/ComboBox"],
				["hslider", "dijit/form/HorizontalSlider"],
				["tabcontainer","dijit/layout/TabContainer"],
				["floatingpane","dojox/layout/FloatingPane"],
				["dialog","dijit/Dialog"],
				["tooltipdialog","dijit/TooltipDialog"],						
				["popup","dijit/popup"],
				["dropdownmenu","dijit/DropDownMenu"],
				["menuitem","dijit/MenuItem"],
				["menuseparator", "dijit/MenuSeparator"],
				["contentpane","dijit/layout/ContentPane"],
				["filteringselect","dijit/form/FilteringSelect"],
				["grid","dojox/grid/DataGrid"],
				["ifrs","dojo/data/ItemFileWriteStore"],
				["memory", "dojo/store/Memory"],			
				["hash", "dojo/hash"],
				["ioquery", "dojo/io-query"],			
				["query", "dojo/query"],
				["string","dojo/string"],
				["number","dojo/number"],
				["json","dojo/json"],
		    ["topic", "dojo/topic"],
		    ["connect", "dojo/_base/connect"],
		    ["on", "dojo/on"],		    
		    ["aspect", "dojo/aspect"],
		    ["request", "dojo/request"],
		    ["script", "dojo/request/script"],		    
		    ["all",  "dojo/promise/all"],
		    ["deferred",  "dojo/Deferred"],
		    ["webMercatorUtils","esri/geometry/webMercatorUtils"],
		    ["accordionContainer", "dijit/layout/AccordionContainer"]
			]
    };
  </script>
	<script type="text/javascript" src="http://js.arcgis.com/3.13"></script>
	<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
	<script type="text/javascript">
		
		var app = {};

		require(["root/template"],function(Template){

			Template.getApplicationInformation().then(function (commonConfig) {
				// If Config Options are Found, make them into the main config object
				if (commonConfig) {
					app.config = commonConfig;
				}

				launch();
			}, function (error) {
				launch();
			});


			function launch () {
				// This is necessary due to the way the original developer set up the project
				// We need to inject some config options in Main and app.config needs
				// to be available before Main is required
				require(["root/main"], function (Main) {

					// Merge Resources in here and then remove all references of resources from the application
					// Only merge in options that are undefined
					
					var language = "en";
					var main = new Main(language);
				});
			}
		});
	</script>	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  	_gaq.push(
	  	['_setAccount', 'UA-1981881-3'],
	  	['_trackPageview'],
	  	['b._setAccount', 'UA-1981181-14'],
	  	['b._trackPageview']
		);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
</head>
<body class="tundra app">
	<div id="customPopup">
		<div id="customPopupClose"></div>
		<div id="customPopupBody">
			<div id="popupTabs">
				<div id='popupDataTab' class="popup-tab" data-bind="text: popupDataTab, css: {active: popupActiveTab() === 'popupDataTab'}, click: changePopupTabs"></div>
				<div id='popupAnalysisTab' class="popup-tab" data-bind="text: popupAnalysisTab, css: {active: popupActiveTab() === 'popupAnalysisTab'}, click: changePopupTabs"></div>
			</div>
			<div id="popupTabContent">
				<div id='popupData' data-bind="visible: popupActiveTab() === 'popupDataTab'">
					<div class="customPopupPrevious" data-bind="visible: popupIndex() > 1, click: prevFeature"></div>
					<div class="customPopupNext" data-bind="visible: popupIndex() < popupCount(), click: nextFeature"></div>
					<div id="infoWindowData">
					</div>
				</div>
				<div id='popupAnalysis' data-bind="visible: popupActiveTab() === 'popupAnalysisTab'">
					<div id="results-header" class="results-header">
						<div class="customPopupPrevious" data-bind="visible: popupIndex() > 1, click: prevFeature"></div>
						<div class="customPopupNext" data-bind="visible: popupIndex() < popupCount(), click: nextFeature"></div>
						<div class="title"></div>
						<div class="edit-name-icon" id="editFeatureName" data-bind="visible: customFeatureShowing()"></div>
						<div class="delete-custom-feature" id="deleteCustomFeature" data-bind="visible: customFeatureShowing(), text: deleteCustomFeature"></div>
					</div>
					<div id="results-container" class="results-container">
						<div class="analysis-selection-types">
							<select data-bind="event: {change: selectAnalysisType}" class='analysis-options-select'>
								<option data-bind="attr: {value: analysisLoss}, text: analysisLoss"></option>
								<option data-bind="attr: {value: analysisLC}, text: analysisLC"></option>
								<option data-bind="attr: {value: analysisCS}, text: analysisCS"></option>
								<option data-bind="attr: {value: analysisTCD}, text: analysisTCD"></option>
								<option data-bind="attr: {value: analysisIFL}, text: analysisIFL"></option>
								<option data-bind="attr: {value: analysisFire}, text: analysisFire"></option>
								<option data-bind="attr: {value: analysisLCComposition}, text: analysisLCComposition"></option>
							</select>
						</div>
						<div id="analysis-loader" class="hidden">
							<span class="loading-wheel"></span>
						</div>
						<div id="results-chart-container">
							<div id="analysis-chart"></div>
						</div>
						<div id="analysis-footer"></div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div data-dojo-type="dijit/layout/BorderContainer"  class="borderContainer" id="mainBorderContainer" data-dojo-props="parseOnLoad:false,gutters:false,design:'headline'"><!-- BorderContainer -->

		<div id="mobileMenu">
			<ul>
				<li><a href="#" target="_blank" data-bind="text:about,attr:{href:aboutLink}"></a></li>
				<li id="mobile_sources"><a data-bind="text:sources"></a></li>
			</ul>
		</div>

		<div data-dojo-type="dijit/layout/ContentPane"  id="headerView" data-dojo-props="region:'top',parseOnLoad:false" class="appBackground">
	
		</div>
		<div data-dojo-type="dijit/layout/ContentPane"  id="navView" data-dojo-props="region:'bottom',parseOnLoad:false" class="appBackground">
				<div id="searchBox">
					<div id="search"></div>
					<div data-dojo-type="dijit/form/DropDownButton" data-dojo-props="id:'searchButton',parseOnLoad:false" id="searchButton">Search</div>
					
				</div>
				<div id="mobileToggle">
					<div class="mobileMenuButton"></div>
				</div>
				<div id="navMenu">
					<ul>
						<li><a href="#" target="_blank" data-bind="text:about,attr:{href:aboutLink}"></a></li>
						<li id="downloadData"><a data-bind="text:downloadData"></a></li>
						<li id="sources"><a data-bind="text:sources"></a></li>
					</ul>
				
				</div>
				
				<div id="languageToggle" style="poisition:absolute;z-index:999">
			 										
				</div>
		</div>
	
		<div data-dojo-type="dijit/layout/ContentPane" id="toolsContainer"  data-dojo-props="region:'left',id:'toolsContainer',parseOnLoad:false" splitter="false" minSize="20">
			
		</div>
		
		
	
		<div data-dojo-type="dijit/layout/StackContainer" id="stackContainer"  data-dojo-props="region:'center',id:'mainStackContainer',parseOnLoad:false">
				
				<div data-dojo-type="dijit/layout/ContentPane" id="mapView" data-dojo-props="parseOnLoad:true">
						
						
						<div id="map" style="overflow:visible !important">
							<div id="openLayersButton" class='open-layers-button' data-bind='text: buttonLayersText'></div>
							<div id="expand">
								<a href="#" class="zoomExpand"></a>
							</div>
							<div class="legendContainer">
						          <div data-dojo-type="dijit/TitlePane" id="legendTitlePane" data-dojo-props="title:'Legend', id:'legendTitlePane',closable:false,  open:false">
										<div data-dojo-type="dijit/layout/ContentPane" id="legendCP"  data-dojo-props="region:'left',id:'legendCP',parseOnLoad:false" splitter="true" minSize="20" style="height: 240px;width:300px;">
			
										</div>
						          </div>
						     </div>	

						  <div id='analyze-button' class="map-button analysis-button hideOnLoad" title="Analyze"></div>
							<div data-bind="visible: analyzeToolsVisible()" class="connector analysis-connector hideOnLoad"></div>
							<div data-bind="visible: analyzeToolsVisible()" class="map-widget-container analysis-controls-container hideOnLoad">
								
								<div class="analyze-tools">
									<div class="analyze-tool-button" id="drawFeatures" data-bind="text:drawButtonText"></div>
									<div class="analyze-tool-button" id="uploadFeatures" data-bind="text:uploadButtonText"></div>
									<div class="clear-all-features" id="clearAllFeatures" data-bind="text: clearAllFeatures"></div>
								</div>

								<div class="upload-tools" data-bind='visible: showUploadTools()'>
									<hr>
									<ul class="upload-instructions" data-bind='foreach: uploadInstructions'>
										<li data-bind='text: $data'></li>
									</ul>
									<form enctype="multipart/form-data" method='post' id='uploadForm' name='uploadForm'>
										<label class="uploadFileLabel">
											<input type="file" name="file" id='shapefileUpload'/>
										</label>
										<!-- These Normally dont need to be included but this fails on first upload
										because esri is too slow to add them in programmatically, possibly because
										this is nested inside a dijit/Dialog -->
										<input type="hidden" name="publishParameters" value="{}" />
										<input type="hidden" name="filetype" value="shapefile" />
										<input type="hidden" name="f" value="json" />
									</form>
									<div id="uploadNameSelectContainer">
										
									</div>
								</div>

							</div>

							<div id='share-button' class="map-button share-button hideOnLoad" title="Share"></div>
							<div data-bind="visible: shareToolsVisible()" class="connector share-connector hideOnLoad"></div>
							<div data-bind="visible: shareToolsVisible()" class="map-widget-container share-container hideOnLoad">
								<div class="sharing_toolbox">
					        <div class="addthis_sharing_toolbox" data-title="WRI Forest Atlas"></div>
					      </div>
							</div>

							<div id='basemap-button' class="map-button basemap-button hideOnLoad" title="Basemaps"></div>
							<div data-bind="visible: basemapGalleryVisible()" class="connector basemap-connector hideOnLoad">
								
							</div>
							<div data-bind="visible: basemapGalleryVisible()" class="map-widget-container basemap-container hideOnLoad">
								<div id='basemap-gallery'></div>
							</div>

							<div id='print-button' class="map-button print-button hideOnLoad" title="Print"></div>
						    
						</div>
	
				</div>	<!-- mapView -->
		
	
	
	
		</div><!-- stackContainer -->

	</div><!-- borderContainer -->
	<!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-35900039-3', 'auto', {'name':"A"});
    ga('A.send', 'pageview');
    ga('create', 'UA-1981181-14', 'auto', {'name':"B"});
    ga('B.send', 'pageview');

  </script>
  <!-- Google Analytics -->
</body>
</html>
