define(["root/analysis/restoration-charts","root/analysis/compute-histogram","root/analysis/analysisConfig","root/analysis/ethiopiaConfig","root/analysis/constants","dojo/promise/all","dojo/dom-class"],function(s,o,a,t,n,e,r){var l=function(s){return 0===s.length?s:s[0].counts.slice(1)},i=function(s,o){if(s.length===o)return s;for(var a=[],t=0;o>t;t++)a[t]=s[t]||0;return a},c=function(s,o,a){return s.map(function(s,t){return{name:o[t],data:[s],color:a[t]}}).filter(function(s){return 0!==s.data[0]&&"No Data"!==s.name})};return{performRestorationAnalysis:function(m,E){var O,R,h,C,g=t.options[E],u=m.geometry,_=g.id,L={},P=a[n.SLOPE],A=a[n.LAND_COVER],T=a[n.POPULATION],d=a[n.TREE_COVER];L[n.SLOPE]=o.multiplyRasters(P.id,_,u),L[n.LAND_COVER]=o.multiplyRasters(A.id,_,u),L[n.POPULATION]=o.multiplyRasters(T,_,u),L[n.TREE_COVER]=o.multiplyRasters(d.id,_,u),e(L).then(function(o){r.add("analysis-loader","hidden"),s.prepareContainer(g.name),O=i(l(o[n.SLOPE].histograms),P.classes.length),R=i(l(o[n.LAND_COVER].histograms),A.classes.length),h=i(l(o[n.POPULATION].histograms),T.classes.length),C=i(l(o[n.TREE_COVER].histograms),d.classes.length),O=c(O,P.classes,P.colors),R=c(R,A.classes,A.colors),h=c(h,T.classes,T.colors),C=c(C,d.classes,d.colors),s.makeChart(n.SLOPE_CHART_ID,P.name,O),s.makeChart(n.LAND_COVER_CHART_ID,A.name,R),s.makeChart(n.POPULATION_CHART_ID,T.name,h),s.makeChart(n.TREE_COVER_CHART_ID,d.name,C),console.log(n.SLOPE,o[n.SLOPE].histograms),console.log(n.LAND_COVER,o[n.LAND_COVER].histograms),console.log(n.POPULATION,o[n.POPULATION].histograms),console.log(n.TREE_COVER,o[n.TREE_COVER].histograms)})}}});