define(["mapui","mainmodel","root/languages","dojo/on","dojo/dom","dijit/Dialog","dojo/Deferred","dijit/registry","esri/graphic","esri/toolbars/draw","esri/geometry/Polygon","atlas/tools/MapAssets"],function(t,e,a,o,i,r,n,s,u,m,c,d){"use strict";var g,l,N=!1,v={init:function(){l=t.getMap(),g=new m(l),g.on("draw-end",this.drawComplete.bind(this))},drawComplete:function(t){if(this.deactivate(),t.geometry){var e,a,o=d.getDrawUploadSymbol(),i=l.getLayer("customGraphicsLayer"),r={};this.promptUserForName().then(function(n){r.CustomFeatureId=d.getNextAvailableId(i.graphics,"CustomFeatureId"),r.Custom_Title=n,a=new c(t.geometry),e=new u(a,o,r),i.add(e)},function(){})}},promptUserForName:function(){function t(){u.remove(),m.destroy()}var u,m,c,d=new n,g=e.getVM(),l=a[g.currentLanguage()];return s.byId("customNamingDialog")&&s.byId("customNamingDialog").destroy(),m=new r({id:"customNamingDialog",title:l.drawNamingDialogTitle,content:'<div class="customFeatureNamingDialog"><input class="customNameForFeature" id="customNameForFeature" type="text" /><button class="customNameDialogSubmit" id="customNameDialogSubmit">'+l.drawNamingDialogSubmit+"</button></div>",style:"width: 300px;"}),m.show(),u=o(i.byId("customNameDialogSubmit"),"click",function(){c=i.byId("customNameForFeature").value,""===c?alert(l.drawNamingDialogNoNameError):(d.resolve(c),t())}),m.on("cancel",function(){d.reject(),u.remove()}),d.promise},activate:function(){var t=e.getVM(),o=a[t.currentLanguage()];N=!0,g.activate(m.FREEHAND_POLYGON),g._tooltip.innerHTML=o.drawTools.freehand},deactivate:function(){g.deactivate(),N=!1},toggle:function(){N?this.deactivate():this.activate()},isActive:function(){return N}};return v});